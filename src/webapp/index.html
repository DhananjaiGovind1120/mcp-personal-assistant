<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Assistant (MCP)</title>
</head>
<body>
  <h1>AI Assistant</h1>
  <select id="toolSelect">
    <option value="add_task">Add Task</option>
    <option value="list_tasks">List Tasks</option>
    <option value="summarize_text">Summarize Text</option>
  </select>
  <br><br>
  <textarea id="inputBox" rows="4" cols="50" placeholder="Type your message..."></textarea>
  <br>
  <button onclick="sendToMCP()">Send</button>
  <pre id="responseBox"></pre>

  <script>
  async function sendToMCP() {
    const tool = document.getElementById("toolSelect").value;
    const input = document.getElementById("inputBox").value;

    const args = {};
    if (tool === "add_task") {
      args.task = input;
    } else if (tool === "summarize_text") {
      args.text = input;
    }

    const eventSource = new EventSource("/sse");

    eventSource.onopen = () => {
      console.log("SSE connection opened.");

      const message = {
        type: "callTool",
        toolName: tool,
        arguments: args
      };

      // Send the tool call once SSE opens
      eventSource.dispatchEvent(new MessageEvent("message", {
        data: JSON.stringify(message)
      }));
    };

    eventSource.onmessage = (event) => {
      const data = JSON.parse(event.data);
      console.log("Received SSE response:", data);

      if (data?.type === "toolResult") {
        document.getElementById("responseBox").innerText = data.result;
        eventSource.close();
      }
    };

    eventSource.onerror = (error) => {
      console.error("SSE error:", error);
      eventSource.close();
    };
  }
</script>
</body>
</html>
