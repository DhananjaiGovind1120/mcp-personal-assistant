<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Assistant (MCP)</title>
</head>
<body>
  <h1>AI Assistant</h1>
  <select id="toolSelect">
    <option value="add_task">Add Task</option>
    <option value="list_tasks">List Tasks</option>
    <option value="summarize_text">Summarize Text</option>
  </select>
  <br><br>
  <textarea id="inputBox" rows="4" cols="50" placeholder="Type your message..."></textarea>
  <br>
  <button onclick="sendToMCP()">Send</button>
  <pre id="responseBox"></pre>

  <script>
  function sendToMCP() {
    const tool = document.getElementById("toolSelect").value;
    const input = document.getElementById("inputBox").value;
    const responseBox = document.getElementById("responseBox");

    const sessionId = "session-" + Date.now();

    // Connect to the server using SSE
    const eventSource = new EventSource(`/sse?session_id=${sessionId}`);
    eventSource.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data?.type === "toolResult") {
        responseBox.innerText = data.result;
        eventSource.close();
      }
    };

    // Correct POST body
    const payload = {
      session_id: sessionId,
      type: "callTool",
      tool_name: tool,
      arguments: {
        task: input,
        text: input
      }
    };

    fetch("/messages/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    }).then((res) => {
      if (!res.ok) {
        responseBox.innerText = `❌ Error: ${res.status}`;
        eventSource.close();
      }
    }).catch((err) => {
      responseBox.innerText = `❌ Failed: ${err}`;
      eventSource.close();
    });
  }
</script>
</body>
</html>
